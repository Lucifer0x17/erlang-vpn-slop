{erl_opts, [debug_info, {d, 'APPLICATION', erlvpn}]}.

%% Core dependencies
%% Note: tunctl (TUN device support) requires procket which needs Linux.
%% On macOS, the server runs in "disabled TUN" mode for dev/testing.
%% To enable: add {tunctl, "0.3.5"} to deps and build on Linux.
{deps, [
    {quicer, "0.2.15"},
    {pkt, {git, "https://github.com/msantos/pkt.git", {branch, "master"}}},
    {jsone, "1.8.1"}
]}.

{project_plugins, [
    rebar3_hex,
    rebar3_ex_doc
]}.

{relx, [
    {release, {erlvpn, "0.1.0"}, [
        erlvpn_common,
        erlvpn_server,
        erlvpn_client,
        sasl,
        crypto,
        ssl
    ]},
    {dev_mode, true},
    {include_erts, false},
    {extended_start_script, true},
    {sys_config, "config/sys.config"},
    {vm_args, "config/vm.args"},
    {overlay, [
        {copy, "erlvpn.toml", "etc/erlvpn.toml"},
        {copy, "client.toml", "etc/client.toml"},
        {copy, "scripts", "scripts"}
    ]}
]}.

{profiles, [
    {prod, [
        {erl_opts, [no_debug_info, warnings_as_errors]},
        {relx, [
            {dev_mode, false},
            {include_erts, true}
        ]}
    ]},
    {test, [
        {erl_opts, [debug_info]},
        {deps, [
            {proper, "1.4.0"},
            {meck, "0.9.2"}
        ]}
    ]}
]}.

{shell, [
    {apps, [erlvpn_common, erlvpn_server, erlvpn_client]}
]}.
